import{$ as P,A as j,F as w,H as W,I as X,N as Z,O as k,R as x,V as B,W as F,Y as D,Z as V,a as z,b as Y,ba as U,c as G,ca as $,e as K,f as Q,g as C,h as J,i as h,ia as A,j as E,ja as q,k as N,ka as R,l as _,la as ee,n as c,o as u,p as v,q as p,r as a,s as n,t as d,u as T,v as M,w as f,x as S,y as l,z as L}from"./chunk-327CQD4X.js";var g=class extends Error{};g.prototype.name="InvalidTokenError";function le(i){return decodeURIComponent(atob(i).replace(/(.)/g,(e,s)=>{let t=s.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function me(i){let e=i.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return le(e)}catch{return atob(e)}}function te(i,e){if(typeof i!="string")throw new g("Invalid token specified: must be a string");e||(e={});let s=e.header===!0?0:1,t=i.split(".")[s];if(typeof t!="string")throw new g(`Invalid token specified: missing part #${s+1}`);let r;try{r=me(t)}catch(o){throw new g(`Invalid token specified: invalid base64 for part #${s+1} (${o.message})`)}try{return JSON.parse(r)}catch(o){throw new g(`Invalid token specified: invalid json for part #${s+1} (${o.message})`)}}var b=(()=>{let e=class e{constructor(t,r){this.http=t,this.router=r,this.url="auth",this.token=new z(null)}signup(t,r,o,m){return this.http.post(`${k.apiUrl}/${this.url}/signup`,{email:t,fullName:r,password:o,confirmPassword:m}).pipe(G(this.handleError))}login(t,r){return this.http.post(`${k.apiUrl}/${this.url}/login`,{email:t,password:r},{responseType:"text"}).pipe(G(this.handleError),K(o=>{localStorage.setItem("authToken",o),this.token.next(o)}))}autoLogin(){let t=localStorage.getItem("authToken");if(t&&t){this.token.next(t);let r=te(t),o=new Date(0);o.setUTCSeconds(r.exp);let m=new Date(o).getTime()-new Date().getTime();this.autoLogout(m)}}logout(){this.token.next(null),this.router.navigate(["/login"]),localStorage.removeItem("authToken"),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer)}autoLogout(t){this.tokenExpirationTimer=setTimeout(()=>{this.logout()},t)}getAccountInfo(){return this.http.get(`${k.apiUrl}/${this.url}/account`)}handleError(t){let r="An unknown error occurred!";return t.error?Y(t.error):Y(r)}};e.\u0275fac=function(r){return new(r||e)(J(X),J(x))},e.\u0275prov=Q({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function ce(i,e){if(i&1&&(a(0,"div")(1,"p"),l(2),n(),a(3,"p"),l(4),n(),a(5,"p"),l(6),n()()),i&2){let s=f();c(2),j("Your id: ",s.user.id,""),c(2),j("Your name: ",s.user.fullName,""),c(2),j("Your email: ",s.user.email,"")}}var oe=(()=>{let e=class e{constructor(t,r){this.authService=t,this.titleService=r}ngOnInit(){this.authService.getAccountInfo().subscribe(t=>{this.user=t,this.titleService.setTitle(`User: ${this.user.fullName}`)})}decodeToken(t){let o=t.split(".")[1].replace(/-/g,"+").replace(/_/,"/"),m=decodeURIComponent(atob(o).split("").map(I=>"%"+("00"+I.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(m)}};e.\u0275fac=function(r){return new(r||e)(u(b),u(Z))},e.\u0275cmp=h({type:e,selectors:[["app-account"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(r,o){r&1&&v(0,ce,7,3,"div",0),r&2&&p("ngIf",o.user)},dependencies:[w]});let i=e;return i})();function de(i,e){if(i&1&&(a(0,"div",7)(1,"p"),l(2),n()()),i&2){let s=f();c(2),L(s.error)}}function ue(i,e){}function fe(i,e){i&1&&(a(0,"div",8)(1,"p"),l(2,"Loading..."),n()())}function ge(i,e){if(i&1){let s=T();a(0,"form",9,0),M("ngSubmit",function(){N(s);let r=S(1),o=f();return _(o.onSubmit(r))}),a(2,"div",10)(3,"label",11),l(4,"E-Mail"),n(),d(5,"input",12),n(),a(6,"div",10)(7,"label",13),l(8,"Password"),n(),d(9,"input",14),n(),d(10,"br"),a(11,"div")(12,"button",15),l(13," Login "),n()()()}if(i&2){let s=S(1);c(12),p("disabled",!s.valid)}}var ne=(()=>{let e=class e{constructor(t,r){this.authService=t,this.router=r,this.error=null,this.isLoading=!1}onSubmit(t){if(!t.valid)return;this.isLoading=!0;let r=t.value.email,o=t.value.password;this.authService.login(r,o).subscribe(m=>{localStorage.setItem("authToken",m),this.router.navigate(["flight"]),this.isLoading=!1,t.reset()},m=>{this.error=m,t.controls.password.reset(),this.isLoading=!1})}};e.\u0275fac=function(r){return new(r||e)(u(b),u(x))},e.\u0275cmp=h({type:e,selectors:[["app-login"]],decls:6,vars:3,consts:[["authForm","ngForm"],[1,"row"],[1,"col-xs-12","col-md-6","col-md-offset-3"],["class","alert alert-danger",4,"ngIf"],["appPlaceholder",""],["style","text-align: center;",4,"ngIf"],[3,"ngSubmit",4,"ngIf"],[1,"alert","alert-danger"],[2,"text-align","center"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","email","ngModel","","name","email","required","","email","",1,"form-control"],["for","password"],["type","password","id","password","ngModel","","name","password","required","","minlength","6",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(r,o){r&1&&(a(0,"div",1)(1,"div",2),v(2,de,3,1,"div",3)(3,ue,0,0,"ng-template",4)(4,fe,3,0,"div",5)(5,ge,14,1,"form",6),n()()),r&2&&(c(2),p("ngIf",o.error),c(2),p("ngIf",o.isLoading),c(),p("ngIf",!o.isLoading))},dependencies:[$,F,D,V,A,R,q,U,P,w]});let i=e;return i})();function he(i,e){if(i&1&&(a(0,"div",16)(1,"p"),l(2),n()()),i&2){let s=f();c(2),L(s.error)}}function ve(i,e){}var ae=(()=>{let e=class e{constructor(t,r){this.authService=t,this.router=r,this.error=null}onSubmit(t){if(!t.valid)return;let r=t.value.email,o=t.value.fullName,m=t.value.password,I=t.value.confirmPassword;m==I?this.authService.signup(r,o,m,I).subscribe(()=>{this.router.navigate(["login"]),t.reset()},O=>{this.error=O}):this.error="Passwords are different."}};e.\u0275fac=function(r){return new(r||e)(u(b),u(x))},e.\u0275cmp=h({type:e,selectors:[["app-signup"]],decls:26,vars:2,consts:[["authForm2","ngForm"],[1,"row"],[1,"col-xs-12","col-md-6","col-md-offset-3"],["class","alert alert-danger",4,"ngIf"],["appPlaceholder",""],[3,"ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","email","ngModel","","name","email","required","","email","",1,"form-control"],["for","fullName"],["type","text","id","fullName","ngModel","","name","fullName","required","",1,"form-control"],["for","password"],["type","password","id","password","ngModel","","name","password","required","","minlength","6",1,"form-control"],["for","confirmPassword"],["type","password","id","confirmPassword","ngModel","","name","confirmPassword","required","","minlength","6",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"alert","alert-danger"]],template:function(r,o){if(r&1){let m=T();a(0,"div",1)(1,"div",2),v(2,he,3,1,"div",3)(3,ve,0,0,"ng-template",4),a(4,"form",5,0),M("ngSubmit",function(){N(m);let O=S(5);return _(o.onSubmit(O))}),a(6,"div",6)(7,"label",7),l(8,"E-Mail"),n(),d(9,"input",8),n(),a(10,"div",6)(11,"label",9),l(12,"Full Name"),n(),d(13,"input",10),n(),a(14,"div",6)(15,"label",11),l(16,"Password"),n(),d(17,"input",12),n(),a(18,"div",6)(19,"label",13),l(20,"Confirm password"),n(),d(21,"input",14),n(),d(22,"br"),a(23,"div")(24,"button",15),l(25," Signup "),n()()()()()}if(r&2){let m=S(5);c(2),p("ngIf",o.error),c(22),p("disabled",!m.valid)}},dependencies:[$,F,D,V,A,R,q,U,P,w]});let i=e;return i})();var Se=[{path:"login",title:"Login",component:ne},{path:"signup",title:"Signup",component:ae},{path:"account",title:"Account",component:oe}],se=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=E({type:e}),e.\u0275inj=C({imports:[B.forChild(Se),B]});let i=e;return i})();var Oe=(()=>{let e=class e{};e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=E({type:e}),e.\u0275inj=C({imports:[ee,W,se]});let i=e;return i})();export{b as a,Oe as b};
