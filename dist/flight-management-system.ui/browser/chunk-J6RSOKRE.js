import{$ as F,A as j,B as G,C as J,D as H,I as b,K as ee,L as te,Q as ie,R as k,U as C,Y as z,Z as V,a as Q,aa as D,b as B,c as O,ca as P,e as X,ea as U,f as Z,fa as A,g as E,h as Y,i as h,j as M,k as v,l as w,la as q,ma as $,n as m,na as R,o as u,oa as re,p as x,q as p,r as a,s as o,t as f,u as N,v as T,w as d,x as S,y as l,z as L}from"./chunk-TUFQYNZZ.js";var g=class extends Error{};g.prototype.name="InvalidTokenError";function pe(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,s)=>{let t=s.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function de(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return pe(e)}catch{return atob(e)}}function ne(r,e){if(typeof r!="string")throw new g("Invalid token specified: must be a string");e||(e={});let s=e.header===!0?0:1,t=r.split(".")[s];if(typeof t!="string")throw new g(`Invalid token specified: missing part #${s+1}`);let i;try{i=de(t)}catch(n){throw new g(`Invalid token specified: invalid base64 for part #${s+1} (${n.message})`)}try{return JSON.parse(i)}catch(n){throw new g(`Invalid token specified: invalid json for part #${s+1} (${n.message})`)}}var y=(()=>{let e=class e{constructor(t,i){this.http=t,this.router=i,this.url="auth",this.token=new Q(null)}signup(t,i,n,c){return this.http.post(`${k.apiUrl}/${this.url}/signup`,{email:t,fullName:i,password:n,confirmPassword:c}).pipe(O(this.handleError))}login(t,i){return this.http.post(`${k.apiUrl}/${this.url}/login`,{email:t,password:i},{responseType:"text"}).pipe(O(this.handleError),X(n=>{localStorage.setItem("authToken",n),this.token.next(n)}))}autoLogin(){let t=localStorage.getItem("authToken");if(t&&t){this.token.next(t);let i=ne(t),n=new Date(0);n.setUTCSeconds(i.exp);let c=new Date(n).getTime()-new Date().getTime();this.autoLogout(c)}}logout(){this.token.next(null),this.router.navigate(["/login"]),localStorage.removeItem("authToken"),this.tokenExpirationTimer&&clearTimeout(this.tokenExpirationTimer)}autoLogout(t){this.tokenExpirationTimer=setTimeout(()=>{this.logout()},t)}getAccountInfo(){return this.http.get(`${k.apiUrl}/${this.url}/account`)}handleError(t){let i="An unknown error occurred!";return t.error?B(t.error):B(i)}};e.\u0275fac=function(i){return new(i||e)(Y(te),Y(C))},e.\u0275prov=Z({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function ue(r,e){if(r&1&&(a(0,"div")(1,"p"),l(2),o(),a(3,"p"),l(4),o(),a(5,"p"),l(6),o()()),r&2){let s=d();m(2),j("Your id: ",s.user.id,""),m(2),j("Your name: ",s.user.fullName,""),m(2),j("Your email: ",s.user.email,"")}}var se=(()=>{let e=class e{constructor(t,i){this.authService=t,this.titleService=i}ngOnInit(){this.authService.getAccountInfo().subscribe(t=>{this.user=t,this.titleService.setTitle(`User: ${this.user.fullName}`)})}decodeToken(t){let n=t.split(".")[1].replace(/-/g,"+").replace(/_/,"/"),c=decodeURIComponent(atob(n).split("").map(_=>"%"+("00"+_.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(c)}};e.\u0275fac=function(i){return new(i||e)(u(y),u(ie))},e.\u0275cmp=h({type:e,selectors:[["app-account"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(i,n){i&1&&x(0,ue,7,3,"div",0),i&2&&p("ngIf",n.user)},dependencies:[b]});let r=e;return r})();function ge(r,e){if(r&1&&(a(0,"div",7)(1,"p"),l(2),o()()),r&2){let s=d();m(2),L(s.error)}}function he(r,e){}function ve(r,e){r&1&&(a(0,"div",8)(1,"p"),l(2,"Loading..."),o()())}function we(r,e){if(r&1){let s=N();a(0,"form",9,0),T("ngSubmit",function(){v(s);let i=S(1),n=d();return w(n.onSubmit(i))}),a(2,"div",10)(3,"label",11),l(4,"E-Mail"),o(),a(5,"input",12),H("ngModelChange",function(i){v(s);let n=d();return J(n.email,i)||(n.email=i),w(i)}),o()(),a(6,"div",10)(7,"label",13),l(8,"Password"),o(),a(9,"input",14),H("ngModelChange",function(i){v(s);let n=d();return J(n.password,i)||(n.password=i),w(i)}),o()(),f(10,"br"),a(11,"div")(12,"button",15),l(13," Login "),o()()()}if(r&2){let s=S(1),t=d();m(5),G("ngModel",t.email),m(4),G("ngModel",t.password),m(3),p("disabled",!s.valid)}}var le=(()=>{let e=class e{constructor(t,i){this.authService=t,this.router=i,this.error=null,this.isLoading=!1,this.email=null,this.password=null}onSubmit(t){t.valid&&(this.isLoading=!0,this.authService.login(this.email,this.password).subscribe(i=>{localStorage.setItem("authToken",i),this.router.navigate(["flight"]),this.isLoading=!1,t.reset()},i=>{this.error=i,this.password="",this.isLoading=!1}))}};e.\u0275fac=function(i){return new(i||e)(u(y),u(C))},e.\u0275cmp=h({type:e,selectors:[["app-login"]],decls:6,vars:3,consts:[["authForm","ngForm"],[1,"row"],[1,"col-xs-12","col-md-6","col-md-offset-3"],["class","alert alert-danger",4,"ngIf"],["appPlaceholder",""],["style","text-align: center;",4,"ngIf"],[3,"ngSubmit",4,"ngIf"],[1,"alert","alert-danger"],[2,"text-align","center"],[3,"ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","email","name","email","required","","email","",1,"form-control",3,"ngModelChange","ngModel"],["for","password"],["type","password","id","password","name","password","required","","minlength","6",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(i,n){i&1&&(a(0,"div",1)(1,"div",2),x(2,ge,3,1,"div",3)(3,he,0,0,"ng-template",4)(4,ve,3,0,"div",5)(5,we,14,3,"form",6),o()()),i&2&&(m(2),p("ngIf",n.error),m(2),p("ngIf",n.isLoading),m(),p("ngIf",!n.isLoading))},dependencies:[A,V,F,D,q,R,$,U,P,b]});let r=e;return r})();function xe(r,e){if(r&1&&(a(0,"div",16)(1,"p"),l(2),o()()),r&2){let s=d();m(2),L(s.error)}}function Se(r,e){}var me=(()=>{let e=class e{constructor(t,i){this.authService=t,this.router=i,this.error=null}onSubmit(t){if(!t.valid)return;let i=t.value.email,n=t.value.fullName,c=t.value.password,_=t.value.confirmPassword;c==_?this.authService.signup(i,n,c,_).subscribe(()=>{this.router.navigate(["login"]),t.reset()},W=>{this.error=W}):this.error="Passwords are different."}};e.\u0275fac=function(i){return new(i||e)(u(y),u(C))},e.\u0275cmp=h({type:e,selectors:[["app-signup"]],decls:26,vars:2,consts:[["authForm2","ngForm"],[1,"row"],[1,"col-xs-12","col-md-6","col-md-offset-3"],["class","alert alert-danger",4,"ngIf"],["appPlaceholder",""],[3,"ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","email","ngModel","","name","email","required","","email","",1,"form-control"],["for","fullName"],["type","text","id","fullName","ngModel","","name","fullName","required","",1,"form-control"],["for","password"],["type","password","id","password","ngModel","","name","password","required","","minlength","6",1,"form-control"],["for","confirmPassword"],["type","password","id","confirmPassword","ngModel","","name","confirmPassword","required","","minlength","6",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"alert","alert-danger"]],template:function(i,n){if(i&1){let c=N();a(0,"div",1)(1,"div",2),x(2,xe,3,1,"div",3)(3,Se,0,0,"ng-template",4),a(4,"form",5,0),T("ngSubmit",function(){v(c);let W=S(5);return w(n.onSubmit(W))}),a(6,"div",6)(7,"label",7),l(8,"E-Mail"),o(),f(9,"input",8),o(),a(10,"div",6)(11,"label",9),l(12,"Full Name"),o(),f(13,"input",10),o(),a(14,"div",6)(15,"label",11),l(16,"Password"),o(),f(17,"input",12),o(),a(18,"div",6)(19,"label",13),l(20,"Confirm password"),o(),f(21,"input",14),o(),f(22,"br"),a(23,"div")(24,"button",15),l(25," Signup "),o()()()()()}if(i&2){let c=S(5);m(2),p("ngIf",n.error),m(22),p("disabled",!c.valid)}},dependencies:[A,V,F,D,q,R,$,U,P,b]});let r=e;return r})();var be=[{path:"login",title:"Login",component:le},{path:"signup",title:"Signup",component:me},{path:"account",title:"Account",component:se}],ce=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=M({type:e}),e.\u0275inj=E({imports:[z.forChild(be),z]});let r=e;return r})();var Ye=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=M({type:e}),e.\u0275inj=E({imports:[re,ee,ce]});let r=e;return r})();export{y as a,Ye as b};
